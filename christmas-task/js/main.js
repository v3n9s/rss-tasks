(()=>{"use strict";let e;function t(){var t,o,n,r,s;return o=this,n=void 0,s=function*(){(null===(t=yield e)||void 0===t?void 0:t.length)||(e=(yield fetch("./assets/data.json")).json());const o=JSON.parse(localStorage.getItem("favToys")||"[]");return(yield e).map((e=>(e.favorite=o.includes(e.num),e)))},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{c(s.next(e))}catch(e){t(e)}}function i(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(a,i)}c((s=s.apply(o,n||[])).next())}))}class o{constructor(e,t,o,n){this.from=e,this.to=t,this.background=o,this.indicators=n;const r=()=>{this.renderBackground(),this.renderValues()};this.from.addEventListener("input",(()=>{this.preventEntryToRight(),this.setHigherZIndexTo(this.from),r()})),this.to.addEventListener("input",(()=>{this.preventEntryToLeft(),this.setHigherZIndexTo(this.to),r()}))}renderBackground(){const e=(+this.from.value-+this.from.min)/(+this.from.max-+this.from.min)*100,t=(+this.to.value-+this.to.min)/(+this.to.max-+this.to.min)*100;this.background.style.backgroundImage=`linear-gradient(90deg, #fff ${e}%, #2c8dff ${e}% ${t}%, #fff ${t}%)`}preventEntryToLeft(){+this.to.value<+this.from.value&&(this.to.value=this.from.value)}preventEntryToRight(){+this.from.value>+this.to.value&&(this.from.value=this.to.value)}renderValues(){this.indicators.from.innerText=this.from.value,this.indicators.to.innerText=this.to.value}setHigherZIndexTo(e){this.from.classList.remove("criteria-control__range_last"),this.to.classList.remove("criteria-control__range_last"),e.classList.add("criteria-control__range_last")}}const n=new o(document.querySelector("#criteria-amount-min"),document.querySelector("#criteria-amount-max"),document.querySelector("#criteria-amount-background"),{from:document.querySelector("#criteria-amount-min-indicator"),to:document.querySelector("#criteria-amount-max-indicator")});n.renderBackground();const r=new o(document.querySelector("#criteria-year-min"),document.querySelector("#criteria-year-max"),document.querySelector("#criteria-year-background"),{from:document.querySelector("#criteria-year-min-indicator"),to:document.querySelector("#criteria-year-max-indicator")});function s(e){return new Promise((t=>{const o=document.createElement("img");o.src=e,o.addEventListener("load",(()=>{t(o.src),o.remove()}))}))}r.renderBackground();var a=function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))};const i=document.querySelector("#draggable-toys");function c(){return a(this,void 0,void 0,(function*(){const e=yield y(),t=e.filter((e=>e.favorite));return(0!==t.length?t:e).slice(0,20)}))}function l(){i.querySelectorAll(".draggable-toys__item").forEach((e=>{const t=e.querySelectorAll(".draggable-toys__img").length;e.querySelector(".setting__amount").innerText=`${t}`}))}function d(e){e.cancelable&&e.preventDefault()}function u(e){e.target.style.top=`${e.clientY}px`,e.target.style.left=`${e.clientX}px`}function m(e){var t,o,n,r,s;const a=e.target;a.style.pointerEvents="none";const i=null===(t=document.elementFromPoint(e.clientX,e.clientY))||void 0===t?void 0:t.closest("[data-dropable]"),c=!!i&&[null===(o=document.elementFromPoint(e.clientX-a.offsetWidth/2,e.clientY))||void 0===o?void 0:o.closest("[data-dropable]"),null===(n=document.elementFromPoint(e.clientX-a.offsetWidth/2,e.clientY+a.offsetHeight))||void 0===n?void 0:n.closest("[data-dropable]"),null===(r=document.elementFromPoint(e.clientX+a.offsetWidth/2,e.clientY+a.offsetHeight))||void 0===r?void 0:r.closest("[data-dropable]"),null===(s=document.elementFromPoint(e.clientX+a.offsetWidth/2,e.clientY))||void 0===s?void 0:s.closest("[data-dropable]")].every((e=>e===i));if(a.style.pointerEvents="all",i&&c){const e=i.getBoundingClientRect(),t=a.getBoundingClientRect();a.style.top=(t.top-e.top)/i.offsetHeight*100+"%",a.style.left=(t.left-e.left)/i.offsetWidth*100+"%",a.classList.add("draggable-toys__img_dropped"),i.append(a)}else{a.classList.add("setting__img");const{toyNum:e}=a.dataset;if(!e)throw new Error("Img doesn't have necessary attribute");const t=document.querySelector(`.setting__item[data-toy-num="${e}"]`);t?t.append(a):a.remove()}a.classList.remove("draggable-toys__img_dragging"),a.removeEventListener("touchmove",d),a.removeEventListener("pointermove",u),a.removeEventListener("pointerup",m),a.removeEventListener("pointercancel",m),l()}document.addEventListener("pointerdown",(function(e){const t=e.target.closest("[data-draggable]");t&&(document.body.append(t),t.setPointerCapture(e.pointerId),t.classList.remove("setting__img"),t.classList.remove("draggable-toys__img_dropped"),t.classList.add("draggable-toys__img_dragging"),t.style.top=`${e.clientY}px`,t.style.left=`${e.clientX}px`,t.addEventListener("touchmove",d),t.addEventListener("pointermove",u),t.addEventListener("pointerup",m),t.addEventListener("pointercancel",m),l())}));var g,f,p=function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function a(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}c((n=n.apply(e,t||[])).next())}))};function y(){return p(this,void 0,void 0,(function*(){const e=[...document.querySelectorAll('[name="criteria-shape"]:checked')].map((e=>e.value)),o=[...document.querySelectorAll('[name="criteria-color"]:checked')].map((e=>e.value)),n=+document.querySelector("#criteria-amount-min").value,r=+document.querySelector("#criteria-amount-max").value,s=+document.querySelector("#criteria-year-min").value,a=+document.querySelector("#criteria-year-max").value,i=["name","year"][document.querySelector("#criteria-sort-property").selectedIndex],c=["asc","desc"][document.querySelector("#criteria-sort-method").selectedIndex];let l=yield t();return l=l.filter((t=>e.includes(t.shape))).filter((e=>o.includes(e.color))).filter((e=>+e.count>=n&&+e.count<=r)).filter((e=>+e.year>=s&&+e.year<=a)).sort(((e,t)=>{if("name"===i){for(let o=0;o<e.name.length||o<t.name.length;o+=1)if(e.name.charCodeAt(o)-t.name.charCodeAt(o)!=0)return e.name.charCodeAt(o)-t.name.charCodeAt(o);return e.name.length-t.name.length}return+e.year-+t.year})),"asc"===c?l:l.reverse()}))}function v(){return p(this,void 0,void 0,(function*(){!function(){a(this,void 0,void 0,(function*(){const[e]=yield Promise.all([c(),s("./assets/svg/ball.svg")]);i.innerHTML="",i.append(...e.map((e=>{var t,o;const n=null!==(o=null===(t=document.querySelector("#tree-img-container"))||void 0===t?void 0:t.querySelectorAll(`.draggable-toys__img[data-toy-num="${e.num}"]`).length)&&void 0!==o?o:0,r=+e.count-n,a=document.createElement("div");a.classList.add("setting__item"),a.classList.add("draggable-toys__item"),a.dataset.toyNum=e.num;const i=[...Array(r)].map((()=>{const t=document.createElement("img");return t.classList.add("setting__img"),t.classList.add("draggable-toys__img"),t.classList.add("setting__img_loading"),t.src="./assets/svg/ball.svg",t.draggable=!1,t.dataset.draggable="",t.dataset.toyNum=e.num,s(`./assets/toys/${e.num}.png`).then((()=>{t.src=`./assets/toys/${e.num}.png`,t.classList.remove("setting__img_loading")})),t})),c=document.createElement("div");return c.classList.add("setting__amount"),c.innerText=`${r}`,a.append(...i,c),a})))}))}();const e=yield y(),t=document.querySelector(".toys__items");if(!t)throw new Error("Toys container not found");t.innerHTML=e.map((e=>`\n    <div class="toy${e.favorite?" toy_favorite":""}" data-toy-id="${e.num}">\n      <h4 class="toy__name">${e.name}</h4>\n      <div class="toy__img-container">\n        <img class="toy__img toy__img_loading">\n      </div>\n      <p class="toy__property">Amount: ${e.count}</p>\n      <p class="toy__property">Year bought: ${e.year}</p>\n      <p class="toy__property">Shape: ${e.shape}</p>\n      <p class="toy__property">Color: ${e.color}</p>\n      <p class="toy__property">Size: ${e.size}</p>\n      <p class="toy__property">is favorite: ${e.favorite?"yes":"no"}</p>\n    </div>\n    `)).join("")||'<p class="toys__items-placeholder">No toys matching selected criteries</p>',t.querySelectorAll(".toy").forEach((e=>{const t=e.dataset.toyId,o=e.querySelector(".toy__img");if(!t)throw new Error("toy ind not found");if(!o)throw new Error("img elem not found");s(`./assets/toys/${t}.png`).then((e=>{o.classList.remove("toy__img_loading"),o.src=e}))}))}))}null===(g=document.querySelector(".toys__filters"))||void 0===g||g.addEventListener("change",(()=>{v()})),null===(f=document.querySelector("#criteria-reset"))||void 0===f||f.addEventListener("click",(()=>{!function(){document.querySelectorAll('[name="criteria-shape"]').forEach((e=>{e.checked=!0})),document.querySelectorAll('[name="criteria-color"]').forEach((e=>{e.checked=!0}));const e=document.querySelector("#criteria-amount-min"),t=document.querySelector("#criteria-amount-max");e.value=e.min,t.value=t.max,n.renderBackground();const o=document.querySelector("#criteria-year-min"),s=document.querySelector("#criteria-year-max");o.value=o.min,s.value=s.max,r.renderBackground()}(),v()})),v();const h=document.querySelector("#alert-list");var _;null===(_=document.querySelector(".toys__items"))||void 0===_||_.addEventListener("click",(e=>{const t=e.target.closest("[data-toy-id]");if(t){const e=t.dataset.toyId;e&&function(e){let t=JSON.parse(localStorage.getItem("favToys")||"[]");t.includes(e)?t=t.filter((t=>t!==e)):20===t.length?function(e){const t=document.createElement("div");t.classList.add("custom-alert__item"),t.innerText="You can't add more than 20 toys to favorites",h.prepend(t),t.addEventListener("animationend",(()=>{t.remove()}))}():t.push(e),localStorage.setItem("favToys",JSON.stringify(t)),v()}(e)}}));const S=document.querySelector(".tree__main");let L,b=!1;function q(){return b}function E(e){return b=null!=e?e:!b,b?L=setInterval((()=>{!function({x:e}){const t=document.createElement("img");t.classList.add("snowflake"),t.src="./assets/svg/snow.svg",t.style.top=`calc(${7*Math.random()-5}%)`,t.style.left=e,t.style.animation=2.5*Math.random()+7.5+"s linear both fall",S.append(t),t.addEventListener("animationend",(()=>{t.remove()}))}({x:Math.random()*(S.offsetWidth-25)/S.offsetWidth*100+"%"})}),200):clearInterval(L),b}let x=!1;const w=document.createElement("audio");function $(){return x}w.src="./assets/audio/audio.mp3",w.volume=.5;let k=new Promise((e=>{e()}));function I(e){x=null!=e?e:!x,x?k=w.play():k.then((()=>w.pause()))}const T=document.querySelector("#tree-img-container");function A(e){document.querySelectorAll(".tree-light").forEach((t=>{t.style.color="random"===e?function(){const e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return`#${[...new Array(6)].map((()=>e[Math.floor(Math.random()*e.length)])).join("")}`}():e}))}var j;[{top:19,left:56},{top:20,left:51},{top:21,left:46},{top:22,left:42},{top:23,left:39},{top:31,left:63},{top:33,left:58},{top:34,left:52},{top:35,left:47},{top:36,left:42},{top:37,left:37},{top:38,left:33},{top:39,left:30},{top:43,left:68},{top:45,left:63},{top:46,left:56},{top:47,left:50},{top:48,left:44},{top:48,left:38},{top:49,left:33},{top:50,left:29},{top:50,left:25},{top:53,left:72},{top:54,left:65},{top:55,left:59},{top:57,left:53},{top:57,left:46},{top:58,left:42},{top:59,left:37},{top:59,left:33},{top:60,left:27},{top:61,left:20},{top:63,left:76},{top:65,left:66},{top:66,left:57},{top:68,left:47},{top:68,left:41},{top:69,left:35},{top:69,left:30},{top:69,left:24},{top:70,left:18},{top:72,left:82},{top:73,left:76},{top:74,left:66},{top:76,left:57},{top:77,left:54},{top:78,left:48},{top:78,left:42},{top:78,left:37},{top:78,left:32},{top:79,left:26},{top:79,left:20},{top:80,left:17},{top:80,left:13}].forEach(((e,t)=>{const o=document.createElement("div");o.classList.add("tree-light"),o.style.top=`${e.top}%`,o.style.left=`${e.left}%`,o.style.color="transparent",o.style.animationDelay=100*t+"ms",T.append(o)}));const P=document.querySelector("#tree-img");function N(e){P.src=e}const U=document.querySelector("#tree-bg-img");function Y(e){U.src=e}const B=document.querySelector("#snow-indicator"),C=document.querySelector("#sound-indicator");function H({selector:e,imgUrl:t,items:o,action:n}){const r=document.querySelector(e);if(!r)throw new Error(`There is not container for '${e}' selector`);r.append(...o.map((e=>{const o=document.createElement("div");o.classList.add("setting__item"),o.dataset.action=n,o.dataset.imgUrl=e;const r=document.createElement("img");return r.classList.add("setting__img"),r.classList.add("setting__img_loading"),r.src=t,s(e).then((()=>{r.classList.remove("setting__img_loading"),r.src=e})),o.append(r),o})))}function J(){q()?B.classList.add("setting__img_on"):B.classList.remove("setting__img_on"),$()?(C.classList.add("setting__img_on"),C.src="./assets/svg/audio.svg"):(C.classList.remove("setting__img_on"),C.src="./assets/svg/mute.svg")}function M({key:e,value:t}){var o;const n=JSON.parse(null!==(o=localStorage.getItem("tree-settings"))&&void 0!==o?o:"{}");n[e]=t,localStorage.setItem("tree-settings",JSON.stringify(n))}H({selector:"#setting-tree",imgUrl:"./assets/svg/tree.svg",items:["./assets/tree/1.png","./assets/tree/2.png","./assets/tree/3.png","./assets/tree/4.png","./assets/tree/5.png","./assets/tree/6.png"],action:"tree-img"}),H({selector:"#setting-background",imgUrl:"./assets/svg/rss.svg",items:["./assets/bg/1.jpg","./assets/bg/2.jpg","./assets/bg/3.jpg","./assets/bg/4.jpg","./assets/bg/5.jpg","./assets/bg/6.jpg","./assets/bg/7.jpg","./assets/bg/8.jpg","./assets/bg/9.jpg","./assets/bg/10.jpg"],action:"tree-bg-img"}),function(){var e;const t=JSON.parse(null!==(e=localStorage.getItem("tree-settings"))&&void 0!==e?e:"{}");"tree-img"in t&&N(t["tree-img"]),"tree-bg-img"in t&&Y(t["tree-bg-img"]),"is-snowfall"in t&&(E(t["is-snowfall"]),J()),"lights-color"in t&&A(t["lights-color"])}(),null===(j=document.querySelector(".tree"))||void 0===j||j.addEventListener("click",(e=>{const t=e.target.closest("[data-action]");t&&("tree-img"===t.dataset.action&&t.dataset.imgUrl?(N(t.dataset.imgUrl),M({key:"tree-img",value:t.dataset.imgUrl})):"tree-bg-img"===t.dataset.action&&t.dataset.imgUrl?(Y(t.dataset.imgUrl),M({key:"tree-bg-img",value:t.dataset.imgUrl})):"toggle-snow"===t.dataset.action?(E(),J(),M({key:"is-snowfall",value:q()})):"toggle-sound"===t.dataset.action?(I(),J(),M({key:"is-sound",value:$()})):"change-lights-color"===t.dataset.action&&t.dataset.color&&(A(t.dataset.color),M({key:"lights-color",value:t.dataset.color})))})),document.body.addEventListener("click",(()=>{var e;const t=JSON.parse(null!==(e=localStorage.getItem("tree-settings"))&&void 0!==e?e:"{}");document.querySelector("#tree-radio").checked&&"is-sound"in t&&(I(t["is-sound"]),J())}))})();